---
title: RequestDispatcher
description: Programa√ß√£o em Java para Web
layout: course
type: classnote
date: 2017-09-04 21:00
---

* TOC
{:toc}

# Introdu√ß√£o

`RequestDispatcher` √© um recurso oferecido pelo servlet que permite que uma requisi√ß√£o seja despachado para
outro servlet processar e entregar a resposta para o cliente.

Note que o despache de requisi√ß√£o ocorre totalmente no lado servidor, o que aparece no lado cliente √© somente
a resposta devolvida. 

# Encaminhamento

Um servlet pode iniciar o processamento e encaminhar para outro servlet concluir.

Isto √© feito com o m√©todo `forward`:

{: data-caption="java" }
```java
RequestDispatcher rd = request.getRequestDispatcher("/lista-clientes.jsp");
rd.forward(request, response);
```

## &lt;jsp:forward&gt;

Dentro do JSP, tamb√©m podemos encaminhar a requisi√ß√£o:

{: data-caption="jsp" }
```html
<jsp:forward page="/lista-clientes.jsp"/>
```

## Antes do corpo da resposta

Nunca escreva o conte√∫do da resposta antes do encaminhamento.
{: data-caption="java" }
```java
// üö´ Este c√≥digo servlet falha porque h√° conte√∫do escrito antes de encaminhar
PrintWriter out = response.getWriter();
out.println("<!-- Coment√°rios antes de repassar -->");

RequestDispatcher rd = request.getRequestDispatcher("/lista-clientes.jsp");
rd.forward(request, response);
```

# Include

Outro tipo de despache √© o `include`: nesse tipo, o servlet inclu√≠do processa a requisi√ß√£o
e depois devolve o controle ao servlet inicial.

{: data-caption="java" }
```java
//
// Pode ter qualquer c√≥digo antes...
//
RequestDispatcher rd = request.getRequestDispatcher("/lista-clientes.jsp");
rd.include(request, response);
//
// ...e qualquer c√≥digo depois!
//
```

## &lt;jsp:include&gt;

```html
<jsp:include page="/lista-clientes.jsp"/>
```

# Enviando valores ao despachar

O objeto `ServletRequest` permite definir atributos para serem lidos pelos outros servlets que participarem
da requisi√ß√£o.

{: data-caption="/servlet1" }
```java
Pessoa p = new Pessoa("Jo√£o", 46);
request.setAttribute("pessoa", p);

RequestDispatcher rd = request.getRequestDispatcher("/servlet2");
rd.forward(request, response);
```

{: data-caption="/servlet2" }
```java
Pessoa p = (Pessoa) request.getAttribute("pessoa");
```

## Lendo valores no JSP

Os atributos s√£o particularmente √∫teis nos arquivos JSP.

Para ler um atributo da requisi√ß√£o, basta ler como uma vari√°vel de template.

{: data-caption="/nome" }
```java
RequestDispatcher rd = request.getRequestDispatcher("/mostra-nome.jsp");
rd.forward(request, response);
```

{: data-caption="/mostra-nome.jsp" }
```smarty
O seu nome √© ${pessoa.nome}
```

### Declarando vari√°veis recebidas no JSP

N√£o √© necess√°rio declarar as vari√°veis para serem acess√≠veis no JSP, mas √© √∫til
para documenta√ß√£o e habilitar a auto-completa√ß√£o da IDE.

Para isso, usa-se `<jsp:useBean>` com o atributo `type` em vez de `class`.

```html
<jsp:useBean id="pessoa" type="fanese.web.Pessoa" scope="request"/>
```

# Leitura Recomendada

**Cap√≠tulo 12**<br>
**P√°ginas 394 √† 398**

![](../../assets/images/livros/goncalves2007-jsp.jpg){:width="200"}
